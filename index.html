<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTG OCR Deck Tracker - GitHub Optimized</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #1e1e1e, #2a2a2a);
            border-radius: 12px;
            border: 1px solid #444;
        }

        .header h1 {
            color: #00d4ff;
            font-size: 2.5rem;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .header p {
            color: #aaa;
            font-size: 1.1rem;
        }

        .workflow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .upload-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
        }

        .upload-header {
            color: #00d4ff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            border: 3px dashed #00d4ff;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 212, 255, 0.05);
        }

        .upload-area:hover {
            border-color: #00b8e6;
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .upload-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .upload-subtext {
            color: #aaa;
            font-size: 0.9rem;
        }

        .file-status {
            background: linear-gradient(135deg, #0a4d3a, #0d5f47);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            color: #00ff88;
        }

        .pdf-link {
            display: inline-block;
            background: linear-gradient(45deg, #ff6b35, #ff8c42);
            color: #000;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .pdf-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .pdf-viewer {
            width: 100%;
            height: 400px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2a2a2a;
            margin-top: 10px;
        }

        .photo-preview {
            background: #222;
            border: 2px solid #00d4ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .photo-img {
            max-width: 100%;
            max-height: 250px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .ocr-processing {
            background: #1a1a1a;
            border: 2px solid #ffaa00;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top: 4px solid #ffaa00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffaa00, #ff8800);
            transition: width 0.3s ease;
            width: 0%;
        }

        .deck-tracker {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .tracker-header {
            color: #00d4ff;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
        }

        .section {
            background: #222;
            border: 1px solid #444;
            border-radius: 8px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: #000;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-content {
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .section-content::-webkit-scrollbar {
            width: 6px;
        }

        .section-content::-webkit-scrollbar-track {
            background: #333;
        }

        .section-content::-webkit-scrollbar-thumb {
            background: #00d4ff;
            border-radius: 3px;
        }

        .column-headers {
            display: grid;
            grid-template-columns: 1fr 50px 50px;
            gap: 8px;
            padding: 8px 0;
            border-bottom: 2px solid #00d4ff;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.85rem;
            color: #00d4ff;
        }

        .card-row {
            display: grid;
            grid-template-columns: 1fr 50px 50px;
            gap: 8px;
            align-items: center;
            padding: 3px 0;
            border-bottom: 1px solid #333;
            font-size: 0.8rem;
        }

        .card-row:last-child {
            border-bottom: none;
        }

        .card-name {
            color: #e0e0e0;
            font-size: 0.75rem;
        }

        .number-input {
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 4px 6px;
            color: #fff;
            text-align: center;
            width: 100%;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .number-input:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }

        .number-input.ocr-detected {
            background: #2a4d2a;
            border-color: #00ff88;
            animation: glow 2s ease-in-out;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 0 2px rgba(0, 255, 136, 0.2); }
            50% { box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.4); }
        }

        .export-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .export-btn {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.3);
        }

        .export-output {
            background: #0a0a0a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }

        .copy-btn {
            background: #666;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .copy-btn:hover {
            background: #777;
        }

        .message {
            padding: 12px 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .success {
            background: linear-gradient(135deg, #0a4d3a, #0d5f47);
            border: 1px solid #00ff88;
            color: #00ff88;
        }

        .error {
            background: linear-gradient(135deg, #4d0a0a, #5f0d0d);
            border: 1px solid #ff4444;
            color: #ff4444;
        }

        .info {
            background: linear-gradient(135deg, #1a3a4d, #1f4a5f);
            border: 1px solid #00d4ff;
            color: #00d4ff;
        }

        .hidden {
            display: none;
        }

        input[type="file"] {
            display: none;
        }

        .ocr-stats {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            text-align: center;
        }

        .stat-item {
            color: #00d4ff;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }

        @media (max-width: 1200px) {
            .workflow {
                grid-template-columns: 1fr;
            }
            
            .sections-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 MTG OCR Deck Tracker</h1>
            <p>Automated handwriting recognition for Magic: The Gathering deck registration</p>
        </div>

        <div class="workflow">
            <!-- PDF Upload -->
            <div class="upload-section">
                <div class="upload-header">
                    <span>📄</span>
                    <span>1. Upload Edge of Eternities PDF</span>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('pdfInput').click()">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Click to Upload PDF</div>
                    <div class="upload-subtext">Your blank deck registration form</div>
                </div>
                <input type="file" id="pdfInput" accept=".pdf">
                <div id="pdfStatus"></div>
            </div>

            <!-- Photo Upload -->
            <div class="upload-section">
                <div class="upload-header">
                    <span>📸</span>
                    <span>2. Upload Photo with Handwritten Numbers</span>
                </div>
                
                <div class="upload-area" onclick="document.getElementById('photoInput').click()">
                    <div class="upload-icon">📸</div>
                    <div class="upload-text">Click to Upload Photo</div>
                    <div class="upload-subtext">Photo of filled-out PDF with numbers 1-9</div>
                </div>
                <input type="file" id="photoInput" accept="image/*">
                <div id="photoStatus"></div>
            </div>
        </div>

        <!-- OCR Processing -->
        <div id="ocrProcessing" class="ocr-processing hidden">
            <div class="processing-spinner"></div>
            <h3 style="color: #ffaa00; margin-bottom: 10px;">🔍 Processing Handwritten Numbers</h3>
            <p style="color: #aaa;">Analyzing photo and detecting numbers 1-9...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="ocrStatus" style="color: #ffaa00; font-weight: 600;"></div>
        </div>

        <!-- OCR Results Stats -->
        <div id="ocrStats" class="ocr-stats hidden">
            <div class="stat-item">
                <span class="stat-value" id="numbersDetected">0</span>
                <span class="stat-label">Numbers Detected</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="cardsPopulated">0</span>
                <span class="stat-label">Cards Populated</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="avgConfidence">0%</span>
                <span class="stat-label">Avg Confidence</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="processingTime">0s</span>
                <span class="stat-label">Processing Time</span>
            </div>
        </div>

        <!-- Deck Tracker -->
        <div class="deck-tracker">
            <div class="tracker-header">🃏 Deck Registration - All Sections</div>
            
            <div class="sections-grid">
                <!-- WHITE -->
                <div class="section">
                    <div class="section-header">
                        <span>⚪ WHITE</span>
                        <span id="whiteCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="whiteCards"></div>
                    </div>
                </div>

                <!-- BLUE -->
                <div class="section">
                    <div class="section-header">
                        <span>🔵 BLUE</span>
                        <span id="blueCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="blueCards"></div>
                    </div>
                </div>

                <!-- BLACK -->
                <div class="section">
                    <div class="section-header">
                        <span>⚫ BLACK</span>
                        <span id="blackCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="blackCards"></div>
                    </div>
                </div>

                <!-- RED -->
                <div class="section">
                    <div class="section-header">
                        <span>🔴 RED</span>
                        <span id="redCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="redCards"></div>
                    </div>
                </div>

                <!-- GREEN -->
                <div class="section">
                    <div class="section-header">
                        <span>🟢 GREEN</span>
                        <span id="greenCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="greenCards"></div>
                    </div>
                </div>

                <!-- MULTICOLOR -->
                <div class="section">
                    <div class="section-header">
                        <span>🌈 MULTICOLOR</span>
                        <span id="multicolorCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="multicolorCards"></div>
                    </div>
                </div>

                <!-- ARTIFACTS -->
                <div class="section">
                    <div class="section-header">
                        <span>⚙️ ARTIFACTS</span>
                        <span id="artifactsCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="artifactsCards"></div>
                    </div>
                </div>

                <!-- NONBASIC LANDS -->
                <div class="section">
                    <div class="section-header">
                        <span>🏔️ NONBASIC LANDS</span>
                        <span id="nonbasicCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="nonbasicCards"></div>
                    </div>
                </div>

                <!-- STELLAR SIGHTS -->
                <div class="section">
                    <div class="section-header">
                        <span>✨ STELLAR SIGHTS</span>
                        <span id="stellarCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="stellarCards"></div>
                    </div>
                </div>

                <!-- SPECIAL GUESTS -->
                <div class="section">
                    <div class="section-header">
                        <span>🎭 SPECIAL GUESTS</span>
                        <span id="specialCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="specialCards"></div>
                    </div>
                </div>

                <!-- BASIC LANDS -->
                <div class="section">
                    <div class="section-header">
                        <span>🌍 BASIC LANDS</span>
                        <span id="basicCount">0 played</span>
                    </div>
                    <div class="section-content">
                        <div class="column-headers">
                            <div>Card Name</div>
                            <div>Played</div>
                            <div>Total</div>
                        </div>
                        <div id="basicCards"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3 style="color: #00d4ff; margin-bottom: 20px;">📋 Export Your Deck</h3>
            <button class="export-btn" onclick="exportDeck()">Generate Final Decklist</button>
            <div id="exportResults" class="hidden">
                <div class="export-output" id="exportOutput"></div>
                <button class="copy-btn" onclick="copyToClipboard()">📋 Copy to Clipboard</button>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        let currentPDF = null;
        let pdfURL = null;
        let deckData = {};
        let ocrStartTime = 0;

        // All card data from Edge of Eternities PDF
        const cardsBySection = {
            white: [
                "All-Fates Stalker", "Astelli Reclaimer", "Auxiliary Boosters", "Banishing Light", "Beyond the Quiet",
                "Brightspear Zealot", "Cosmogrand Zenith", "Dawnstrike Vanguard", "Dockworker Drone", "Dual-Sun Adepts",
                "Dual-Sun Technique", "Emergency Eject", "Exalted Sunborn", "Exosuit Savior", "Flight-Deck Coordinator",
                "Focus Fire", "Haliya, Guided by Light", "Hardlight Containment", "Honor", "Honored Knight-Captain",
                "Knight Luminary", "Lightstall Inquisitor", "Lumen-Class Frigate", "Luxknight Breacher", "Pinnacle Starcage",
                "Pulsar Squadron Ace", "Radiant Strike", "Rayblade Trooper", "Reroute Systems", "Rescue Skiff",
                "Scout for Survivors", "Seam Rip", "The Seriema", "Squire's Lightblade", "Starfield Shepherd",
                "Starfighter Pilot", "Starport Security", "Sunstar Chaplain", "Sunstar Expansionist", "Sunstar Lightsmith",
                "Wedgelight Rammer", "Weftblade Enhancer", "Zealous Display"
            ],
            blue: [
                "Annul", "Atomic Microsizer", "Cerebral Download", "Cloudsculpt Technician", "Codecracker Hound",
                "Consult the Star Charts", "Cryogen Relic", "Cryoshatter", "Desculpting Blast", "Divert Disaster",
                "Emissary Escort", "Gigastorm Titan", "Illvoi Galeblade", "Illvoi Infiltrator", "Illvoi Light Jammer",
                "Illvoi Operative", "Lost in Space", "Mechan Assembler", "Mechan Navigator", "Mechan Shieldmate",
                "Mechanozoa", "Mental Modulation", "Mm'menon, the Right Hand", "Moonlit Meditation", "Mouth of the Storm",
                "Nanoform Sentinel", "Quantum Riddler", "Scour for Scrap", "Selfcraft Mechan", "Sinister Cryologist",
                "Specimen Freighter", "Starbreach Whale", "Starfield Vocalist", "Starwinder", "Steelswarm Operator",
                "Synthesizer Labship", "Tractor Beam", "Unravel", "Uthros Psionicist", "Uthros Scanship", "Weftwalking"
            ],
            black: [
                "Alpharael, Stonechosen", "Archenemy's Charm", "Beamsaw Prospector", "Blade of the Swarm", "Chorale of the Void",
                "Comet Crawler", "Dark Endurance", "Decode Transmissions", "Depressurize", "Dubious Delicacy",
                "Elegy Acolyte", "Embrace Oblivion", "Entropic Battlecruiser", "Faller's Faithful", "Fell Gravship",
                "Gravblade Heavy", "Gravkill", "Gravpack Monoist", "Hullcarver", "Hylderblade",
                "Hymn of the Faller", "Insatiable Skittermaw", "Lightless Evangel", "Monoist Circuit-Feeder", "Monoist Sentry",
                "Perigee Beckoner", "Requiem Monolith", "Scrounge for Eternity", "Sothera, the Supervoid", "Sunset Saboteur",
                "Susurian Dirgecraft", "Susurian Voidborn", "Swarm Culler", "Temporal Intervention", "Timeline Culler",
                "Tragic Trajectory", "Umbral Collar Zealot", "Virus Beetle", "Voidforged Titan", "Vote Out",
                "Xu-Ifit, Osteoharmonist", "Zero Point Ballad"
            ],
            red: [
                "Bombard", "Cut Propulsion", "Debris Field Crusher", "Devastating Onslaught", "Drill Too Deep",
                "Frontline War-Rager", "Full Bore", "Galvanizing Sawship", "Invasive Maneuvers", "Kav Landseeker",
                "Kavaron Harrier", "Kavaron Skywarden", "Kavaron Turbodrone", "Lithobraking", "Melded Moxite",
                "Memorial Team Leader", "Memorial Vault", "Molecular Modifier", "Nebula Dragon", "Nova Hellkite",
                "Orbital Plunge", "Oreplate Pangolin", "Pain for All", "Plasma Bolt", "Possibility Technician",
                "Red Tiger Mechan", "Remnant Elemental", "Rig for War", "Roving Actuator", "Ruinous Rampage",
                "Rust Harvester", "Slagdrill Scrapper", "Systems Override", "Tannuk, Steadfast Second", "Terminal Velocity",
                "Terrapact Intimidator", "Territorial Bruntar", "Vaultguard Trooper", "Warmaker Gunship", "Weapons Manufacturing",
                "Weftstalker Ardent", "Zookeeper Mechan"
            ],
            green: [
                "Atmospheric Greenhouse", "Bioengineered Future", "Biosynthic Burst", "Blooming Stinger", "Broodguard Elite",
                "Close Encounter", "Diplomatic Relations", "Drix Fatemaker", "Edge Rover", "Eumidian Terrabotanist",
                "Eusocial Engineering", "Famished Worldsire", "Frenzied Baloth", "Fungal Colossus", "Galactic Wayfarer",
                "Gene Pollinator", "Germinating Wurm", "Glacier Godmaw", "Harmonious Grovestrider", "Hemosymbic Mite",
                "Icecave Crasher", "Icetill Explorer", "Intrepid Tenderfoot", "Larval Scoutlander", "Lashwhip Predator",
                "Loading Zone", "Meltstrider Eulogist", "Meltstrider's Gear", "Meltstrider's Resolve", "Mightform Harmonizer",
                "Ouroboroid", "Pull Through the Weft", "Sami's Curiosity", "Seedship Agrarian", "Seedship Impact",
                "Shattered Wings", "Skystinger", "Sledge-Class Seedship", "Tapestry Warden", "Terrasymbiosis", "Thawbringer"
            ],
            multicolor: [
                "
