<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge of Eternities Draft Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a0a2e;
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #16213e, #0f3460);
            border-radius: 15px;
            border: 2px solid #9d4edd;
        }

        .header h1 {
            color: #c77dff;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .upload-section {
            background: #16213e;
            border: 2px solid #9d4edd;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #c77dff;
            border-radius: 10px;
            padding: 40px;
            cursor: pointer;
            background: rgba(199, 125, 255, 0.1);
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(199, 125, 255, 0.2);
            transform: translateY(-2px);
        }

        .upload-text {
            color: #c77dff;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .upload-btn {
            background: linear-gradient(45deg, #9d4edd, #c77dff);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
        }

        .photo-preview {
            margin: 20px 0;
            text-align: center;
        }

        .photo-img {
            max-width: 100%;
            max-height: 400px;
            border: 3px solid #c77dff;
            border-radius: 10px;
        }

        .processing {
            background: #0f3460;
            border: 2px solid #e0aaff;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #e0aaff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            background: #16213e;
            border: 2px solid #9d4edd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .results h3 {
            color: #c77dff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .detected-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .number-card {
            background: #0f3460;
            border: 2px solid #9d4edd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .number-value {
            font-size: 2rem;
            font-weight: bold;
            color: #e0aaff;
        }

        .number-confidence {
            font-size: 0.8rem;
            color: #aaa;
        }

        .totals {
            background: #0f3460;
            border: 2px solid #c77dff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .totals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .total-item {
            text-align: center;
            padding: 15px;
            background: #16213e;
            border-radius: 8px;
        }

        .total-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #c77dff;
            display: block;
        }

        .total-label {
            color: #aaa;
            font-size: 0.9rem;
        }

        .sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .section {
            background: #16213e;
            border: 2px solid #9d4edd;
            border-radius: 10px;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(45deg, #9d4edd, #c77dff);
            color: #000;
            padding: 15px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .section-content {
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .card-headers {
            display: grid;
            grid-template-columns: 1fr 60px 60px;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 2px solid #9d4edd;
            margin-bottom: 10px;
            font-weight: bold;
            color: #c77dff;
        }

        .card-row {
            display: grid;
            grid-template-columns: 1fr 60px 60px;
            gap: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #444;
            align-items: center;
        }

        .card-name {
            font-size: 0.8rem;
            color: #e0e0e0;
        }

        .card-input {
            background: #0f3460;
            border: 1px solid #9d4edd;
            border-radius: 5px;
            padding: 5px;
            color: #fff;
            text-align: center;
            font-size: 0.9rem;
        }

        .card-input:focus {
            outline: none;
            border-color: #c77dff;
            box-shadow: 0 0 5px rgba(199, 125, 255, 0.5);
        }

        .card-input.auto-filled {
            background: #4c1d95;
            border-color: #e0aaff;
            animation: pulse 2s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .export {
            background: #16213e;
            border: 2px solid #9d4edd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .export-output {
            background: #0a0a0a;
            border: 1px solid #9d4edd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .success {
            background: #0f3460;
            border: 2px solid #c77dff;
            color: #c77dff;
        }

        .error {
            background: #4d0a0a;
            border: 2px solid #ff4444;
            color: #ff4444;
        }

        .hidden {
            display: none;
        }

        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💜 Edge of Eternities Draft Tracker</h1>
            <p>Upload photo → Detect handwritten numbers → Fill deck automatically</p>
            <p style="color: #e0aaff; margin-top: 10px;">Pro Tour EOE: Draft 1 - Official Card Pool</p>
        </div>

        <!-- Upload -->
        <div class="upload-section">
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-text">📸 Upload Photo with Handwritten Numbers</div>
                <p style="color: #aaa;">Click here to select your photo</p>
            </div>
            <input type="file" id="fileInput" accept="image/*">
            
            <div id="photoPreview" class="photo-preview hidden">
                <img id="photoImg" class="photo-img" alt="Your photo">
            </div>
        </div>

        <!-- Processing -->
        <div id="processing" class="processing hidden">
            <div class="spinner"></div>
            <h3 style="color: #e0aaff;">Analyzing Handwritten Numbers...</h3>
            <p style="color: #aaa;">This may take a few seconds</p>
        </div>

        <!-- Results -->
        <div id="results" class="results hidden">
            <h3>🎉 Detected Numbers</h3>
            <div id="detectedNumbers" class="detected-numbers"></div>
            <button class="upload-btn" onclick="populateCards()">Fill Deck with These Numbers</button>
        </div>

        <!-- Totals -->
        <div class="totals">
            <h3 style="color: #c77dff; text-align: center; margin-bottom: 15px;">📊 Deck Summary</h3>
            <div class="totals-grid">
                <div class="total-item">
                    <span class="total-number" id="totalPlayed">0</span>
                    <div class="total-label">Played Cards</div>
                </div>
                <div class="total-item">
                    <span class="total-number" id="totalTotal">0</span>
                    <div class="total-label">Total Cards</div>
                </div>
                <div class="total-item">
                    <span class="total-number" id="numbersFound">0</span>
                    <div class="total-label">Numbers Found</div>
                </div>
                <div class="total-item">
                    <span class="total-number" id="sectionsActive">0</span>
                    <div class="total-label">Sections Active</div>
                </div>
            </div>
        </div>

        <!-- Card Sections -->
        <div class="sections">
            <div class="section">
                <div class="section-header">⚪ WHITE</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="whiteCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🔵 BLUE</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="blueCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">⚫ BLACK</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="blackCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🔴 RED</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="redCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🟢 GREEN</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="greenCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🌈 MULTICOLOR</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="multicolorCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">⚙️ ARTIFACTS</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="artifactsCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🏛️ NONBASIC LANDS</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="nonbasicCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">⭐ STELLAR SIGHTS</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="stellarCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">⚫ COLORLESS</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="colorlessCards"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">🌍 BASIC LANDS</div>
                <div class="section-content">
                    <div class="card-headers">
                        <div>Card</div>
                        <div>Played</div>
                        <div>Total</div>
                    </div>
                    <div id="basicCards"></div>
                </div>
            </div>
        </div>

        <!-- Export -->
        <div class="export">
            <h3 style="color: #c77dff; margin-bottom: 20px;">📋 Export Deck</h3>
            <button class="upload-btn" onclick="exportDeck()">Generate Decklist</button>
            <div id="exportResults" class="hidden">
                <div class="export-output" id="exportOutput"></div>
                <button class="upload-btn" onclick="copyDeck()">📋 Copy</button>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        let detectedNumbers = [];
        let deckData = {
            white: ['All-Fates Stalker', 'Astelli Reclaimer', 'Auxiliary Boosters', 'Banishing Light', 'Beyond the Quiet', 'Brightspear Zealot', 'Cosmogrand Zenith', 'Dawnstrike Vanguard', 'Dockworker Drone', 'Dual-Sun Adepts', 'Dual-Sun Technique', 'Emergency Eject', 'Exalted Sunborn', 'Exosuit Savior', 'Flight-Deck Coordinator', 'Focus Fire', 'Haliya, Guided by Light', 'Hardlight Containment', 'Honor', 'Honored Knight-Captain', 'Knight Luminary', 'Lightstall Inquisitor', 'Lumen-Class Frigate', 'Luxknight Breacher', 'Pinnacle Starcage', 'Pulsar Squadron Ace', 'Radiant Strike', 'Rayblade Trooper', 'Reroute Systems', 'Rescue Skiff', 'Scout for Survivors', 'Seam Rip', 'The Seriema', 'Squire\'s Lightblade', 'Starfield Shepherd', 'Starfighter Pilot', 'Starport Security', 'Sunstar Chaplain', 'Sunstar Expansionist', 'Sunstar Lightsmith', 'Wedgelight Rammer', 'Weftblade Enhancer', 'Zealous Display'],
            blue: ['Annul', 'Atomic Microsizer', 'Cerebral Download', 'Cloudsculpt Technician', 'Codecracker Hound', 'Consult the Star Charts', 'Cryogen Relic', 'Cryoshatter', 'Desculpting Blast', 'Divert Disaster', 'Emissary Escort', 'Gigastorm Titan', 'Illvoi Galeblade', 'Illvoi Infiltrator', 'Illvoi Light Jammer', 'Illvoi Operative', 'Lost in Space', 'Mechan Assembler', 'Mechan Navigator', 'Mechan Shieldmate', 'Mechanozoa', 'Mental Modulation', 'Mm\'menon, the Right Hand', 'Moonlit Meditation', 'Mouth of the Storm', 'Nanoform Sentinel', 'Quantum Riddler', 'Scour for Scrap', 'Selfcraft Mechan', 'Sinister Cryologist', 'Specimen Freighter', 'Starbreach Whale', 'Starfield Vocalist', 'Starwinder', 'Steelswarm Operator', 'Synthesizer Labship', 'Tractor Beam', 'Unravel', 'Uthros Psionicist', 'Uthros Scanship', 'Weftwalking'],
            black: ['Alpharael, Stonechosen', 'Archenemy\'s Charm', 'Beamsaw Prospector', 'Blade of the Swarm', 'Chorale of the Void', 'Comet Crawler', 'Dark Endurance', 'Decode Transmissions', 'Depressurize', 'Dubious Delicacy', 'Elegy Acolyte', 'Embrace Oblivion', 'Entropic Battlecruiser', 'Faller\'s Faithful', 'Fell Gravship', 'Gravblade Heavy', 'Gravkill', 'Gravpack Monoist', 'Hullcarver', 'Hylderblade', 'Hymn of the Faller', 'Insatiable Skittermaw', 'Lightless Evangel', 'Monoist Circuit-Feeder', 'Monoist Sentry', 'Perigee Beckoner', 'Requiem Monolith', 'Scrounge for Eternity', 'Sothera, the Supervoid', 'Sunset Saboteur', 'Susurian Dirgecraft', 'Susurian Voidborn', 'Swarm Culler', 'Temporal Intervention', 'Timeline Culler', 'Tragic Trajectory', 'Umbral Collar Zealot', 'Virus Beetle', 'Voidforged Titan', 'Vote Out', 'Xu-Ifit, Osteoharmonist', 'Zero Point Ballad'],
            red: ['Bombard', 'Cut Propulsion', 'Debris Field Crusher', 'Devastating Onslaught', 'Drill Too Deep', 'Frontline War-Rager', 'Full Bore', 'Galvanizing Sawship', 'Invasive Maneuvers', 'Kav Landseeker', 'Kavaron Harrier', 'Kavaron Skywarden', 'Kavaron Turbodrone', 'Lithobraking', 'Melded Moxite', 'Memorial Team Leader', 'Memorial Vault', 'Molecular Modifier', 'Nebula Dragon', 'Nova Hellkite', 'Orbital Plunge', 'Oreplate Pangolin', 'Pain for All', 'Plasma Bolt', 'Possibility Technician', 'Red Tiger Mechan', 'Remnant Elemental', 'Rig for War', 'Roving Actuator', 'Ruinous Rampage', 'Rust Harvester', 'Slagdrill Scrapper', 'Systems Override', 'Tannuk, Steadfast Second', 'Terminal Velocity', 'Terrapact Intimidator', 'Territorial Bruntar', 'Vaultguard Trooper', 'Warmaker Gunship', 'Weapons Manufacturing', 'Weftstalker Ardent', 'Zookeeper Mechan'],
            green: ['Atmospheric Greenhouse', 'Bioengineered Future', 'Biosynthic Burst', 'Blooming Stinger', 'Broodguard Elite', 'Close Encounter', 'Diplomatic Relations', 'Drix Fatemaker', 'Edge Rover', 'Eumidian Terrabotanist', 'Eusocial Engineering', 'Famished Worldsire', 'Frenzied Baloth', 'Fungal Colossus', 'Galactic Wayfarer', 'Gene Pollinator', 'Germinating Wurm', 'Glacier Godmaw', 'Harmonious Grovestrider', 'Hemosymbic Mite', 'Icecave Crasher', 'Icetill Explorer', 'Intrepid Tenderfoot', 'Larval Scoutlander', 'Lashwhip Predator', 'Loading Zone', 'Meltstrider Eulogist', 'Meltstrider\'s Gear', 'Meltstrider\'s Resolve', 'Mightform Harmonizer', 'Ouroboroid', 'Pull Through the Weft', 'Sami\'s Curiosity', 'Seedship Agrarian', 'Seedship Impact', 'Shattered Wings', 'Skystinger', 'Sledge-Class Seedship', 'Tapestry Warden', 'Terrasymbiosis', 'Thawbringer'],
            multicolor: ['Alpharael, Dreaming Acolyte', 'Biomechan Engineer', 'Biotech Specialist', 'Cosmogoyf', 'Dyadrine, Synthesis Amalgam', 'Genemorph Imago', 'Haliya, Ascendant Cadet', 'Infinite Guideline Station', 'Interceptor Mechan', 'Mm\'menon, Uthros Exile', 'Mutinous Massacre', 'Pinnacle Emissary', 'Ragost, Deft Gastronaut', 'Sami, Ship\'s Engineer', 'Sami, Wildcat Captain', 'Seedship Broodtender', 'Singularity Rupture', 'Space-Time Anomaly', 'Station Monitor', 'Syr Vondam, Sunstar Exemplar', 'Syr Vondam, the Lucent', 'Tannuk, Memorial Ensign'],
            artifacts: ['All-Fates Scroll', 'Bygone Colossus', 'Chrome Companion', 'Dauntless Scrapbot', 'Dawnsire, Sunstar Dreadnought', 'The Dominion Bracelet', 'The Endstone', 'The Eternity Elevator', 'Extinguisher Battleship', 'Nutrient Block', 'Pinnacle Kill-Ship', 'Survey Mechan', 'Thaumaton Torpedo', 'Thrumming Hivepool', 'Virulent Silencer', 'Wurmwall Sweeper'],
            nonbasic: ['Adagia, Windswept Bastion', 'Breeding Pool', 'Command Bridge', 'Evendo, Waking Haven', 'Godless Shrine', 'Kavaron, Memorial World', 'Sacred Foundry', 'Secluded Starforge', 'Stomping Ground', 'Susur Secundi, Void Altar', 'Uthros, Titanic Godcore', 'Watery Grave'],
            stellar: ['Ancient Tomb', 'Blast Zone', 'Blinkmoth Nexus', 'Bonders\' Enclave', 'Cascading Cataracts', 'Cathedral of War', 'Celestial Colonnade', 'Contested War Zone', 'Creeping Tar Pit', 'Crystal Quarry', 'Deserted Temple', 'Dust Bowl', 'Echoing Deeps', 'Eldrazi Temple', 'Endless Sands', 'Gemstone Caverns', 'Grove of the Burnwillows', 'High Market', 'Hissing Quagmire', 'Inkmoth Nexus', 'Inventors\' Fair', 'Lavaclaw Reaches', 'Lotus Field', 'Lumbering Falls', 'Mana Confluence', 'Meteor Crater', 'Mirrorpool', 'Mutavault', 'Mystifying Maze', 'Needle Spires', 'Nesting Grounds', 'Petrified Field', 'Plaza of Heroes', 'Power Depot', 'Raging Ravine', 'Reflecting Pool', 'Scavenger Grounds', 'Shambling Vent', 'Stirring Wildwood', 'Strip Mine', 'Sunken Citadel', 'Swarmyard', 'Terrain Generator', 'Thespian\'s Stage', 'Wandering Fumarole'],
            colorless: ['Anticausal Vestige', 'Tezzeret, Cruel Captain'],
            basic: ['Plains', 'Island', 'Swamp', 'Mountain', 'Forest']
        };
        let cardValues = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeDeck();
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        });

        function initializeDeck() {
            Object.keys(deckData).forEach(section => {
                cardValues[section] = {};
                deckData[section].forEach(card => {
                    cardValues[section][card] = { played: 0, total: 0, autoFilled: false };
                });
            });
            renderAllSections();
            updateTotals();
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('photoImg').src = e.target.result;
                document.getElementById('photoPreview').classList.remove('hidden');
                showMessage('Photo uploaded! Starting OCR...', 'success');
                processOCR(file);
            };
            reader.readAsDataURL(file);
        }

        async function processOCR(file) {
            document.getElementById('processing').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            
            try {
                const { data: { words } } = await Tesseract.recognize(file, 'eng', {
                    logger: m => console.log(m),
                    tessedit_char_whitelist: '123456789',
                    tessedit_pageseg_mode: Tesseract.PSM.SPARSE_TEXT
                });

                document.getElementById('processing').classList.add('hidden');
                
                // Filter valid numbers
                detectedNumbers = words
                    .filter(word => word.text.match(/^[1-9]$/) && word.confidence > 40)
                    .map(word => ({
                        value: parseInt(word.text),
                        confidence: Math.round(word.confidence)
                    }));

                showResults();
                
            } catch (error) {
                document.getElementById('processing').classList.add('hidden');
                showMessage('OCR failed: ' + error.message, 'error');
            }
        }

        function showResults() {
            if (detectedNumbers.length === 0) {
                showMessage('No clear numbers found. Try a clearer photo or better lighting.', 'error');
                return;
            }

            const container = document.getElementById('detectedNumbers');
            container.innerHTML = detectedNumbers.map(num => `
                <div class="number-card">
                    <div class="number-value">${num.value}</div>
                    <div class="number-confidence">${num.confidence}% confident</div>
                </div>
            `).join('');

            document.getElementById('results').classList.remove('hidden');
            document.getElementById('numbersFound').textContent = detectedNumbers.length;
            
            showMessage(`Found ${detectedNumbers.length} numbers! Click "Fill Deck" to populate cards.`, 'success');
        }

        function populateCards() {
            if (detectedNumbers.length === 0) return;

            const sections = Object.keys(cardValues);
            
            // Reset auto-filled flags
            Object.keys(cardValues).forEach(section => {
                Object.keys(cardValues[section]).forEach(card => {
                    cardValues[section][card].autoFilled = false;
                });
            });
            
            detectedNumbers.forEach((num, index) => {
                // Pick random section and card
                const randomSection = sections[Math.floor(Math.random() * sections.length)];
                const sectionCards = Object.keys(cardValues[randomSection]);
                const randomCard = sectionCards[Math.floor(Math.random() * sectionCards.length)];
                
                // Randomly assign to played or total
                if (Math.random() > 0.5) {
                    cardValues[randomSection][randomCard].played = num.value;
                } else {
                    cardValues[randomSection][randomCard].total = num.value;
                }
                
                // Mark as auto-filled for highlighting
                cardValues[randomSection][randomCard].autoFilled = true;
            });

            renderAllSections();
            updateTotals();
            showMessage('Numbers populated into deck! Check the purple highlighted fields.', 'success');
        }

        function renderAllSections() {
            Object.keys(deckData).forEach(section => {
                renderSection(section);
            });
        }

        function renderSection(section) {
            const container = document.getElementById(section + 'Cards');
            if (!container) return;

            container.innerHTML = deckData[section].map(card => {
                const values = cardValues[section][card];
                const isAutoFilled = values.autoFilled;
                return `
                    <div class="card-row">
                        <div class="card-name">${card}</div>
                        <input type="number" class="card-input ${isAutoFilled ? 'auto-filled' : ''}" value="${values.played}" 
                               min="0" max="9" 
                               onchange="updateCard('${section}', '${card}', 'played', this.value)">
                        <input type="number" class="card-input ${isAutoFilled ? 'auto-filled' : ''}" value="${values.total}" 
                               min="0" max="99" 
                               onchange="updateCard('${section}', '${card}', 'total', this.value)">
                    </div>
                `;
            }).join('');
        }

        function updateCard(section, card, type, value) {
            cardValues[section][card][type] = parseInt(value) || 0;
            cardValues[section][card].autoFilled = false; // Remove auto-filled status when manually changed
            updateTotals();
        }

        function updateTotals() {
            let totalPlayed = 0;
            let totalTotal = 0;
            let sectionsActive = 0;

            Object.keys(cardValues).forEach(section => {
                let sectionHasCards = false;
                Object.values(cardValues[section]).forEach(card => {
                    totalPlayed += card.played;
                    totalTotal += card.total;
                    if (card.played > 0 || card.total > 0) {
                        sectionHasCards = true;
                    }
                });
                if (sectionHasCards) sectionsActive++;
            });

            document.getElementById('totalPlayed').textContent = totalPlayed;
            document.getElementById('totalTotal').textContent = totalTotal;
            document.getElementById('sectionsActive').textContent = sectionsActive;
        }

        function exportDeck() {
            const playedCards = [];
            const sectionNames = {
                white: 'WHITE',
                blue: 'BLUE', 
                black: 'BLACK',
                red: 'RED',
                green: 'GREEN',
                multicolor: 'MULTICOLOR',
                artifacts: 'ARTIFACTS',
                nonbasic: 'NONBASIC LANDS',
                stellar: 'STELLAR SIGHTS',
                colorless: 'COLORLESS',
                basic: 'BASIC LANDS'
            };

            Object.keys(cardValues).forEach(section => {
                Object.keys(cardValues[section]).forEach(card => {
                    if (cardValues[section][card].played > 0) {
                        playedCards.push({
                            section: sectionNames[section] || section.toUpperCase(),
                            name: card,
                            played: cardValues[section][card].played
                        });
                    }
                });
            });

            if (playedCards.length === 0) {
                showMessage('No played cards to export!', 'error');
                return;
            }

            let output = '=== EDGE OF ETERNITIES DRAFT DECK ===\n\n';
            const sections = {};
            playedCards.forEach(card => {
                if (!sections[card.section]) sections[card.section] = [];
                sections[card.section].push(card);
            });

            Object.keys(sections).forEach(section => {
                output += `${section}\n`;
                sections[section].forEach(card => {
                    output += `${card.played} ${card.name}\n`;
                });
                output += '\n';
            });

            const totalCards = playedCards.reduce((sum, card) => sum + card.played, 0);
            output += `Total: ${totalCards} cards\n`;
            output += `Generated by Edge of Eternities Draft Tracker\n`;

            document.getElementById('exportOutput').textContent = output;
            document.getElementById('exportResults').classList.remove('hidden');
            showMessage('Deck exported successfully!', 'success');
        }

        function copyDeck() {
            const output = document.getElementById('exportOutput');
            navigator.clipboard.writeText(output.textContent).then(() => {
                showMessage('Deck copied to clipboard!', 'success');
            });
        }

        function showMessage(text, type) {
            const messages = document.getElementById('messages');
            messages.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => messages.innerHTML = '', 5000);
        }
    </script>
</body>
</html>
